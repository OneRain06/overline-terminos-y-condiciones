<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overline Studio Builder</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0f172a;
  --card:#1e293b;
  --accent:#00C2FF;
  --accent2:#2563eb;
  --text:#f1f5f9;
  --muted:#94a3b8;
}

*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:'Inter',sans-serif;
  background:linear-gradient(135deg,#0f172a,#111827);
  color:var(--text);
}

/* HEADER */
header{
  padding:20px 40px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{
  font-weight:700;
  font-size:20px;
  letter-spacing:1px;
}

.cart-btn{
  background:var(--accent);
  border:none;
  padding:10px 15px;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
}

/* LAYOUT */
.container{
  display:grid;
  grid-template-columns:250px 1fr;
}

.sidebar{
  padding:30px;
}

.category{
  padding:10px 15px;
  margin-bottom:8px;
  border-radius:8px;
  cursor:pointer;
  color:var(--muted);
  transition:.3s;
}

.category.active,
.category:hover{
  background:var(--accent);
  color:#000;
}

.main{
  padding:40px;
}

.hero{
  background:linear-gradient(135deg,var(--accent2),var(--accent));
  padding:40px;
  border-radius:20px;
  margin-bottom:40px;
}

.hero h1{
  font-size:32px;
  margin-bottom:10px;
}

/* GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
  gap:20px;
}

.card{
  background:var(--card);
  padding:20px;
  border-radius:15px;
  transition:.3s;
}

.card:hover{
  transform:translateY(-5px);
  box-shadow:0 10px 30px rgba(0,194,255,.2);
}

.price{
  font-weight:bold;
  margin:10px 0;
}

.add{
  background:var(--accent);
  border:none;
  padding:8px 12px;
  border-radius:6px;
  cursor:pointer;
}

/* OFFCANVAS */
.offcanvas{
  position:fixed;
  top:0;
  right:-420px;
  width:400px;
  max-width:100%;
  height:100%;
  background:rgba(30,41,59,.98);
  backdrop-filter:blur(20px);
  padding:30px;
  transition:.4s cubic-bezier(.77,0,.18,1);
  overflow-y:auto;
  z-index:999;
  box-shadow:-10px 0 40px rgba(0,0,0,.5);
}

.offcanvas.active{
  right:0;
}

.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  backdrop-filter:blur(3px);
  display:none;
  z-index:998;
}

.cart-item{
  margin-bottom:15px;
}

.qty{
  background:var(--accent);
  border:none;
  padding:2px 6px;
  margin:0 3px;
  border-radius:4px;
  cursor:pointer;
}

.progress{
  background:#111827;
  height:8px;
  border-radius:5px;
  margin:10px 0;
  overflow:hidden;
}

.progress-bar{
  height:100%;
  background:var(--accent);
  width:0%;
  transition:.4s;
}

.generate{
  background:var(--accent2);
  border:none;
  padding:10px;
  border-radius:8px;
  cursor:pointer;
  width:100%;
  font-weight:600;
  margin-top:15px;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transition:.3s ease;
  z-index:1000;
}

.modal.active{
  opacity:1;
  pointer-events:auto;
}

.modal-content{
  background:#1e293b;
  padding:30px;
  border-radius:15px;
  width:400px;
  max-width:90%;
  transform:translateY(20px);
  transition:.3s ease;
}

.modal.active .modal-content{
  transform:translateY(0);
}

.modal input{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border:none;
  border-radius:6px;
}

/* LOADER */
.loader{
  border:4px solid rgba(255,255,255,.1);
  border-top:4px solid var(--accent);
  border-radius:50%;
  width:30px;
  height:30px;
  animation:spin 1s linear infinite;
  margin:auto;
}

@keyframes spin{
  to{transform:rotate(360deg);}
}

/* TOAST */
.toast{
  position:fixed;
  bottom:30px;
  right:30px;
  background:var(--accent);
  color:#000;
  padding:15px 20px;
  border-radius:10px;
  font-weight:600;
  opacity:0;
  transform:translateY(20px);
  transition:.4s;
  z-index:2000;
}

.toast.show{
  opacity:1;
  transform:translateY(0);
}

/* MOBILE */
@media(max-width:900px){

  .container{
    grid-template-columns:1fr;
  }

  .sidebar{
    display:flex;
    overflow-x:auto;
    gap:10px;
    padding:15px 20px;
    background:rgba(30,41,59,.9);
    position:sticky;
    top:0;
    z-index:5;
  }

  .category{
    white-space:nowrap;
    margin-bottom:0;
  }
}
</style>
</head>

<body>

<header>
  <a href="https://overlineagencia.com.co/">
    <img src="logo.webp" style="width:120px;">
  </a>
  <button class="cart-btn" onclick="toggleCart()">Proyecto üõí</button>
</header>

<div class="container">
  <div class="sidebar">
    <div class="category active" onclick="filter('all',this)">Todos</div>
    <div class="category" onclick="filter('branding',this)">Branding</div>
    <div class="category" onclick="filter('audiovisual',this)">Audiovisual</div>
    <div class="category" onclick="filter('redes',this)">Redes</div>
  </div>

  <div class="main">
    <div class="hero">
      <h1>Construye tu sistema creativo</h1>
      <p>Desbloquea beneficios seg√∫n tu inversi√≥n.</p>
    </div>
    <div class="grid" id="grid"></div>
  </div>
</div>

<div class="offcanvas" id="cartPanel">
  <button onclick="toggleCart()" style="position:absolute;top:15px;right:15px;background:none;border:none;color:white;font-size:18px;cursor:pointer;">‚úï</button>
  <h2>Tu Proyecto</h2>
  <div id="cartItems"></div>

  <div class="progress">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <p>Subtotal: $<span id="subtotalEl">0</span></p>
  <p>Descuento: <span id="discountEl">0</span>%</p>
  <h3>Total: $<span id="totalEl">0</span></h3>
  <label style="display:flex;align-items:center;gap:8px;margin:10px 0;font-size:14px;cursor:pointer;">
  <input type="checkbox" id="ivaCheck" onchange="update()" style="cursor:pointer;">
  Aplicar IVA 19%
</label>

<p>IVA: $<span id="ivaEl">0</span></p>
<h3>Total Final: $<span id="totalFinalEl">0</span></h3>

<p style="font-size:12px;color:#94a3b8">
  *Precios sin IVA incluido salvo que se especifique.
</p>


  <button class="generate" onclick="openModal()">Generar Cotizaci√≥n</button>
</div>

<div class="overlay" id="overlay" onclick="toggleCart()"></div>

<div class="modal" id="modal">
  <div class="modal-content">
    <h3>Datos para cotizaci√≥n</h3>
    <input id="nombre" placeholder="Nombre persona o empresa">
    <input id="documento" placeholder="C√©dula o NIT">
    <input id="ciudad" placeholder="Ciudad">
    <input id="email" placeholder="Email">
    <input id="whatsapp" placeholder="WhatsApp">
    <button class="generate" onclick="enviar()" id="sendBtn">
      Enviar Cotizaci√≥n
    </button>
    <div id="loading" style="display:none;margin-top:15px;text-align:center;">
      <div class="loader"></div>
      <p style="margin-top:10px;font-size:14px;">Generando cotizaci√≥n...</p>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>
	
	<script>

/* =========================
ENDPOINT
========================= */

const ENDPOINT="https://script.google.com/macros/s/AKfycbyigMIoemcqF77cohGxd8lYWEQMn4eFogpnX5SPdvxaMwJtuYUlFu7aHL8l4cncLXf1/exec";

/* =========================
ELEMENTOS UI
========================= */

const cartPanel = document.getElementById("cartPanel");
const overlay = document.getElementById("overlay");
const modal = document.getElementById("modal");
const grid = document.getElementById("grid");
const cartItems = document.getElementById("cartItems");
const progressBar = document.getElementById("progressBar");

const subtotalEl = document.getElementById("subtotalEl");
const discountEl = document.getElementById("discountEl");
const totalEl = document.getElementById("totalEl");
const ivaEl = document.getElementById("ivaEl");
const totalFinalEl = document.getElementById("totalFinalEl");

const toast = document.getElementById("toast");
const sendBtn = document.getElementById("sendBtn");
const loading = document.getElementById("loading");

const nombre = document.getElementById("nombre");
const documento = document.getElementById("documento");
const ciudad = document.getElementById("ciudad");
const email = document.getElementById("email");
const whatsapp = document.getElementById("whatsapp");

/* =========================
SERVICIOS
========================= */

const services=[
{
  id:1,
  name:"Logo Profesional",
  price:400000,
  cat:"branding",
  level:"B",
  description:{
    objetivo:"Construcci√≥n estrat√©gica de identidad visual.",
    incluye:[
      "Investigaci√≥n conceptual",
      "3 propuestas iniciales",
      "2 rondas de ajustes",
      "Archivos editables y PNG"
    ],
    entrega:"5 a 8 d√≠as h√°biles"
  }
},
{
  id:2,
  name:"Manual de Marca",
  price:800000,
  cat:"branding",
  level:"C",
  description:{
    objetivo:"Documento estrat√©gico de lineamientos visuales.",
    incluye:[
      "Normas de uso",
      "Colores",
      "Tipograf√≠as",
      "Aplicaciones"
    ],
    entrega:"8 a 12 d√≠as h√°biles"
  }
},
{
  id:3,
  name:"Reel B√°sico",
  price:250000,
  cat:"audiovisual",
  level:"B",
  description:{
    objetivo:"Video corto optimizado para redes.",
    incluye:[
      "Edici√≥n din√°mica",
      "Subt√≠tulos",
      "Formato vertical"
    ],
    entrega:"3 a 5 d√≠as h√°biles"
  }
},
{
  id:4,
  name:"Reel Pro",
  price:500000,
  cat:"audiovisual",
  level:"C",
  description:{
    objetivo:"Producci√≥n audiovisual premium.",
    incluye:[
      "Gui√≥n",
      "Grabaci√≥n",
      "Edici√≥n avanzada",
      "Color grading"
    ],
    entrega:"7 a 10 d√≠as h√°biles"
  }
},
{
  id:5,
  name:"Gesti√≥n Redes",
  price:600000,
  cat:"redes",
  level:"B",
  description:{
    objetivo:"Administraci√≥n mensual estrat√©gica.",
    incluye:[
      "Calendario",
      "Dise√±os",
      "Copywriting",
      "Reporte"
    ],
    entrega:"Servicio mensual"
  }
}
];

/* =========================
VARIABLES
========================= */

let cart={};
let subtotal=0;
let discount=0;
let total=0;
let ivaValor=0;
let totalFinal=0;

function format(n){
  return Number(n).toLocaleString("es-CO");
}

/* =========================
RENDER
========================= */

function render(list){

  grid.innerHTML="";

  list.forEach(s=>{

    const incluyeHTML = s.description.incluye
      .map(i=>`<li>${i}</li>`).join("");

    grid.innerHTML+=`
    <div class="card">

      <h3>${s.name}</h3>

      <p style="font-size:13px;color:#94a3b8;margin-top:8px;">
      ${s.description.objetivo}
      </p>

      <ul style="font-size:12px;color:#94a3b8;margin-top:8px;padding-left:18px;">
      ${incluyeHTML}
      </ul>

      <p style="font-size:12px;color:#64748b;margin-top:6px;">
      Entrega: ${s.description.entrega}
      </p>

      <div class="price">$ ${format(s.price)}</div>

      <button class="add" onclick="add(${s.id})">
      Agregar
      </button>

    </div>
    `;
  });
}

/* =========================
FILTRO
========================= */

function filter(cat,el){

  document.querySelectorAll(".category")
  .forEach(c=>c.classList.remove("active"));

  el.classList.add("active");

  if(cat==="all") render(services);
  else render(services.filter(s=>s.cat===cat));

}

/* =========================
CARRITO
========================= */

function add(id){

  const s=services.find(x=>x.id===id);

  if(cart[id]) cart[id].qty++;
  else cart[id]={...s,qty:1};

  update();
  save();

}

function change(id,v){

  cart[id].qty+=v;

  if(cart[id].qty<=0)
    delete cart[id];

  update();
  save();

}

function update(){

  subtotal=0;
  let totalC=0;

  cartItems.innerHTML="";

  Object.values(cart).forEach(i=>{

    const t=i.price*i.qty;

    subtotal+=t;

    if(i.level==="C") totalC+=t;

    cartItems.innerHTML+=`
    <div class="cart-item">

      ${i.name} x${i.qty}

      <button class="qty" onclick="change(${i.id},1)">+</button>
      <button class="qty" onclick="change(${i.id},-1)">-</button>

      <br>$ ${format(t)}

    </div>`;
  });

  let credits=Math.floor(subtotal/100000);

  if(credits>=15) discount=18;
  else if(credits>=10) discount=15;
  else if(credits>=6) discount=10;
  else if(credits>=3) discount=5;
  else discount=0;

  if(subtotal>0 && (totalC/subtotal)>0.4)
    discount=Math.min(discount,10);

  total=subtotal-(subtotal*(discount/100));

  const aplicarIVA=document.getElementById("ivaCheck").checked;

  ivaValor= aplicarIVA ? total*0.19 : 0;

  totalFinal= total + ivaValor;

  subtotalEl.textContent=format(subtotal);
  discountEl.textContent=discount;
  totalEl.textContent=format(total);
  ivaEl.textContent=format(ivaValor);
  totalFinalEl.textContent=format(totalFinal);

  progressBar.style.width=Math.min((credits/15)*100,100)+"%";

}

/* =========================
ENV√çO
========================= */

async function enviar(){

  const cliente={
    nombre:nombre.value.trim(),
    documento:documento.value.trim(),
    ciudad:ciudad.value.trim(),
    email:email.value.trim(),
    whatsapp:whatsapp.value.trim()
  };

  if(Object.values(cliente).some(v=>!v)){
    showToast("Completa todos los campos");
    return;
  }

  if(Object.keys(cart).length===0){
    showToast("Agrega al menos un servicio");
    return;
  }

  sendBtn.style.display="none";
  loading.style.display="block";

  const carrito = Object.values(cart).map(i => {

  const objetivo = i.description?.objetivo || "";

  const incluye = Array.isArray(i.description?.incluye)
    ? i.description.incluye.join(", ")
    : "";

  return {
    nombre: i.name || "",
    descripcion: objetivo + (incluye ? " | " + incluye : ""),
    qty: i.qty || 0,
    precio: i.price || 0,
    total: (i.price || 0) * (i.qty || 0)
  };

});


  try{

    const response=await fetch(ENDPOINT,{
      method:"POST",
      headers:{
        "Content-Type":"application/json"
      },
      body:JSON.stringify({
        cliente,
        carrito,
        subtotal,
        iva:ivaValor,
        totalFinal
      })
    });

    const text=await response.text();

    if(!response.ok || !text.includes("OK"))
      throw new Error(text);

    showToast("Cotizaci√≥n enviada üöÄ");

    cart={};

    update();
    save();

    closeModal();

  }catch(err){

    console.error(err);

    showToast("Error al enviar");

  }

  loading.style.display="none";
  sendBtn.style.display="block";

}

/* =========================
UTILIDADES
========================= */

function toggleCart(){

  cartPanel.classList.toggle("active");

  overlay.style.display=
    cartPanel.classList.contains("active")
    ?"block":"none";

}

function openModal(){
  modal.classList.add("active");
}

function closeModal(){
  modal.classList.remove("active");
}

function showToast(msg){

  toast.textContent=msg;

  toast.classList.add("show");

  setTimeout(()=>{
    toast.classList.remove("show");
  },3000);

}

function save(){

  localStorage.setItem(
    "overlineCart",
    JSON.stringify({
      cart,
      iva:document.getElementById("ivaCheck").checked
    })
  );

}

function load(){

  const d = localStorage.getItem("overlineCart");

  if(!d) return;

  try{

    const data = JSON.parse(d);

    cart = {};

    Object.values(data.cart || {}).forEach(savedItem=>{

      const original = services.find(s=>s.id == savedItem.id);

      if(original){

        cart[original.id] = {
          ...original,
          qty: savedItem.qty
        };

      }

    });

    if(data.iva)
      document.getElementById("ivaCheck").checked = true;

    update();

  }
  catch(e){

    console.error("Error loading cart", e);

    localStorage.removeItem("overlineCart");

  }

}


/* INIT */

render(services);
load();

</script>

</body>
</html>



